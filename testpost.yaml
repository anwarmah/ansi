#Make requests to example api
hosts: localhost
connection: local
vars:
    data:
      bruce:
        name: bruce
        salary: 46000
        age: 27
      jessica:
        name: jessica
        salary: 70000
        age: 30
 tasks:
  - name: create employee
      uri:
        method: POST
        url: "http://dummy.restapiexample.com/api/v1/create"
        return_content: yes
        headers:
          Accept: application/json
        body_format: json
        body: "{{ item.value | to_json }}" //Render valid json from each dictionary in the variable data.
      with_dict: "{{ data }}"
      register: post_content

 #   - debug:
 #       msg: "{{ item.content }}"
 #     with_items: "{{ post_content.results }}"
   - local_action: "copy content='{{ response_code.stdout }}' dest=/root/status.txt"  
	
  - name: HTTP 200 status
    find:
      paths: /root/
      patterns: '*.txt'
      file_type: file
      contains: "{{ pattern1 }}"
    register: response_200

  - debug:
      msg: HTTP Status Code 200
    when: response_200.matched > 0

  - name: HTTP 404 status
    find:
      paths: /root/
      patterns: '*.txt'
      file_type: file
      contains: "{{ pattern2 }}"
    register: response_404
  
  - debug:
      msg: HTTP Status Code 404
    when: response_404.matched > 0  
